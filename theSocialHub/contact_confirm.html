<?php
    $visitor_name = filter_input(INPUT_POST, 'name');
    $visitor_email = filter_input(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);
    $visitor_msg = filter_input(INPUT_POST, 'message');
    
    
    
    if ($visitor_name == NULL || $visitor_email == NULL || $visitor_msg == NULL) {
        $error = "Invalid input data. Check all fields and try again.";
        echo "Form Data Error: " . $error;
        exit();
    } else {
        $dsn = 'mysql:host=localhost;dbname=shContact';
        $username = 'sh_user';
        $password = 'Pa$$w0rd';

        try {
            $db = new PDO($dsn, $username, $password);
        } catch (PDOException $e) {
            $error_message = $e->getMessage();
            echo "Database error: " . $error_message;
            exit();
        }

        // Add visitor info to db
        $query = 'INSERT INTO visitor (visitor_name, visitor_email, visitor_msg, visit_date, employeeID)
            VALUES (:name, :email, :message, NOW(), 1)';
    $statement = $db->prepare($query);
    $statement->bindValue(':name', $visitor_name);
    $statement->bindValue(':email', $visitor_email);
    $statement->bindValue(':message', $visitor_msg);
    $statement->execute();
    $statement->closeCursor();
    }
?>

<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <title>The Social Hub</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="css/normalize.css">
        <link rel="stylesheet" type="text/css" href="css/styles.css">
        <script src="js/nav.js"></script>
    </head>
    <body>
        <header>
            <div class="topnav" id="myTopnav">
                <a href="index.html" class="active">TheSocialHub</a>
                <a href="#about">About</a>
                <a href="#news">News</a>
                <a href="#contact">Contact</a>
                <a href="javascript:void(0);" class="icon" onclick="myFunction()">
                  <i class="fa fa-bars"></i>
                </a>
              </div>
        </header>
        <section id="thankyou">
          <h2>Thank you, <?php echo $visitor_name; ?>, for reaching out to us! Typically,
          we will respond within 48 business hours.</h2>
        </section>
    </body>
</html>
